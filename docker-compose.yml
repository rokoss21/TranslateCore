# üê≥ TranslateCore Docker Compose Configuration
version: '3.8'

services:
  translatecore:
    build: .
    container_name: translatecore
    hostname: translatecore
    
    # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
    stdin_open: true
    tty: true
    
    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è API –∫–ª—é—á–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    environment:
      - DEEPL_API_KEY=${DEEPL_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - MICROSOFT_API_KEY=${MICROSOFT_API_KEY:-}
      - LIBRETRANSLATE_URL=${LIBRETRANSLATE_URL:-}
      - LIBRETRANSLATE_API_KEY=${LIBRETRANSLATE_API_KEY:-}
      - PYTHONPATH=/app
      - TRANSLATE_DATA_DIR=/app/data
      - TRANSLATE_CACHE_DIR=/app/cache
      - TRANSLATE_LOG_DIR=/app/logs
      
    # Persistent volumes –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    volumes:
      - translatecore_data:/app/data
      - translatecore_cache:/app/cache  
      - translatecore_logs:/app/logs
      - ./custom_configs:/app/custom_configs:ro  # –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤
      
    # Restart policy
    restart: unless-stopped
    
    # Resource limits (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '2.0'
        reservations:
          memory: 512M
          cpus: '0.5'

  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: LibreTranslate server –¥–ª—è –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç–∏
  libretranslate:
    image: libretranslate/libretranslate:latest
    container_name: libretranslate_server
    hostname: libretranslate
    profiles: ["with-libretranslate"]  # –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
    
    ports:
      - "5000:5000"
      
    environment:
      - LT_DISABLE_WEB_UI=false
      - LT_API_KEYS=true
      - LT_REQUIRE_API_KEY_ORIGIN=false
      
    volumes:
      - libretranslate_data:/app/db
      
    restart: unless-stopped
    
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: '4.0'
        reservations:
          memory: 1G
          cpus: '1.0'

# Named volumes –¥–ª—è persistence
volumes:
  translatecore_data:
    driver: local
  translatecore_cache:
    driver: local
  translatecore_logs:
    driver: local
  libretranslate_data:
    driver: local

# Network –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
networks:
  default:
    driver: bridge
    name: translatecore_network

# Инструкции по переводу русского текста в проекте

## Обзор

Созданы два Python скрипта для точного извлечения и замены русского текста в проекте:

1. **extract_russian_text.py** - извлекает русский текст из Python файлов
2. **replace_russian_text.py** - заменяет русский текст переводами

## Извлечение русского текста

### Запуск скрипта извлечения

```bash
python3 extract_russian_text.py
```

### Что делает скрипт

- Сканирует все Python файлы в каталоге `bazi_lib/core/`
- Извлекает русский текст из:
  - Строковых литералов (`"текст"`, `'текст'`)
  - Многострочных строк (`"""текст"""`, `'''текст'''`)
  - F-строк (`f"текст {переменная}"`)
  - Комментариев (`# текст`)
- Создает два выходных файла

### Выходные файлы

1. **russian_text_data.txt** - детальные данные для точной замены
   - Формат: `HASH|TYPE|FILE|LINE|ORIGINAL_TEXT`
   - Содержит информацию о местоположении каждого текста

2. **russian_text_simple.txt** - упрощенный файл для перевода  
   - Формат: `HASH|ORIGINAL_TEXT|TRANSLATED_TEXT`
   - Содержит только уникальные тексты для перевода

### Статистика последнего запуска

- **Найдено файлов:** 15 Python файлов
- **Всего вхождений:** 2,605 фрагментов русского текста  
- **Уникальных текстов:** 2,192 строки для перевода

## Заполнение переводов

### Инструкции

1. Откройте файл `russian_text_simple.txt`
2. Заполните **третий столбец** переводами
3. **НЕ изменяйте** структуру строк - только добавляйте переводы после последнего символа `|`

### Пример заполнения

```
# До заполнения:
858b569e|  Вызовы:|
2396a90e|  Сильные стороны:|

# После заполнения:
858b569e|  Вызовы:|  Challenges:
2396a90e|  Сильные стороны:|  Strengths:
```

### Особенности перевода

- Многострочные тексты обозначены как `\\n` - они будут восстановлены автоматически
- Сохраняйте форматирование (пробелы в начале/конце строк)
- Переводите только русский текст, оставляя техническую информацию на английском

## Замена текста переводами

### Запуск скрипта замены

```bash
python3 replace_russian_text.py
```

### Что делает скрипт

- Загружает переводы из `russian_text_simple.txt`
- Загружает детальные данные из `russian_text_data.txt`  
- Создает резервные копии всех изменяемых файлов в каталоге `backup_before_translation/`
- Выполняет точные замены в исходных файлах
- Предоставляет детальный отчет о выполненных заменах

### Безопасность

- **Автоматическое создание резервных копий** - все изменяемые файлы сохраняются
- **Точная замена** - текст заменяется только в указанных местах с правильным типом (строка/комментарий)
- **Подтверждение операции** - скрипт запрашивает подтверждение перед началом замены
- **Детальная отчетность** - показывает все выполненные изменения

## Пример использования

### 1. Извлечение

```bash
$ python3 extract_russian_text.py
Найдено 15 Python файлов
Обрабатывается: bazi_lib/core/symbolic_stars.py
...
Всего найдено 2605 вхождений русского текста
Уникальных текстов: 2192

Созданы файлы:
  russian_text_data.txt - детальные данные для точной замены
  russian_text_simple.txt - упрощенный файл для перевода
```

### 2. Заполнение переводов

Откройте `russian_text_simple.txt` и заполните переводы:

```
c166e685|Основные классы и концепции Бацзы|Core classes and concepts of BaZi
cf10773f|Главный класс для создания и анализа карт Бацзы|Main class for creating and analyzing BaZi charts
...
```

### 3. Замена

```bash
$ python3 replace_russian_text.py
Загружаем переводы...
Загружено 1500 переводов
Загружаем детальные данные...
Загружено 2605 записей
Будет выполнено 1500 замен в 15 файлах
Продолжить замену? (y/N): y

Обрабатывается: bazi_lib/core/bazi_chart.py
  Создана резервная копия: backup_before_translation/bazi_chart.py
  Выполнено 385 замен
...
Завершено!
Успешно обработано 15 файлов
```

## Восстановление файлов

Если необходимо откатить изменения:

```bash
# Восстановить все файлы
cp backup_before_translation/* bazi_lib/core/

# Восстановить конкретный файл  
cp backup_before_translation/bazi_chart.py bazi_lib/core/
```

## Технические детали

### Типы извлекаемого текста

- **string** - обычные строковые литералы
- **multiline_string** - многострочные docstrings
- **f_string** - текстовые части f-строк
- **comment** - комментарии после символа `#`

### Алгоритм точной замены

1. Загружаются переводы по хешам
2. Определяется точное местоположение каждого текста (файл + строка + тип)
3. Выполняется контекстная замена с учетом типа текста:
   - Для строк - замена внутри кавычек
   - Для комментариев - замена после символа `#`
   - Сохранение синтаксиса Python

### Хеширование

Каждый фрагмент текста получает уникальный MD5-хеш (8 символов), что обеспечивает:
- Точную идентификацию текста
- Защиту от случайных замен
- Возможность отслеживания переводов

## Рекомендации

1. **Тестирование** - после замены запустите тесты проекта
2. **Поэтапный перевод** - можете переводить файлы по частям
3. **Проверка синтаксиса** - убедитесь, что Python код остается корректным
4. **Версионный контроль** - используйте git для отслеживания изменений

## Поддерживаемые языки

Скрипты настроены для:
- **Извлечение:** кириллические символы (русский, украинский, белорусский и т.д.)
- **Замена:** любые Unicode символы в переводах

Для адаптации под другие языки измените регулярное выражение в функции `is_cyrillic_text()`.
